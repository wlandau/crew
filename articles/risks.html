<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Known risks of crew • crew</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Known risks of crew">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">crew</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>How to use `crew`</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to crew</a></li>
    <li><a class="dropdown-item" href="../articles/groups.html">Controller groups</a></li>
    <li><a class="dropdown-item" href="../articles/logging.html">Logging</a></li>
    <li><a class="dropdown-item" href="../articles/shiny.html">Asynchronous Shiny apps</a></li>
    <li><a class="dropdown-item" href="../articles/promises.html">Integration with promises</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Technical details</h6></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Launcher plugins</a></li>
    <li><a class="dropdown-item" href="../articles/risks.html">Known risks of crew</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wlandau/crew/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Known risks of crew</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wlandau/crew/blob/main/vignettes/risks.Rmd" class="external-link"><code>vignettes/risks.Rmd</code></a></small>
      <div class="d-none name"><code>risks.Rmd</code></div>
    </div>

    
    
<p>The <code>crew</code> package has unavoidable risks, and the user is
responsible for safety, security, and computational resources. This
vignette describes known risks and safeguards, but is by no means
exhaustive. Please read the <a href="https://wlandau.github.io/crew/LICENSE.html">software
license</a>.</p>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<div class="section level3">
<h3 id="processes">Processes<a class="anchor" aria-label="anchor" href="#processes"></a>
</h3>
<p>The <code>crew</code> package launches external R processes:</p>
<ol style="list-style-type: decimal">
<li>Worker processes to run tasks, which may include expensive jobs on
cloud services like AWS Batch or traditional clusters like SLURM.</li>
<li>The <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>
dispatcher, an R process which send tasks to workers and retrieves
results back. If <code>x</code> is a <code>crew</code> controller, a
<code><a href="https://ps.r-lib.org/reference/ps_handle.html" class="external-link">ps::ps_handle()</a></code> process handle of the dispatcher is
retained in <code>x$client$dispatcher</code>.</li>
</ol>
<p>In the event of a poorly-timed crash or network error, these
processes may not terminate properly. If that happens, they will
continue to run, which may strain traditional clusters or incur heavy
expenses on the cloud. Please monitor the platforms you use and manually
terminate defunct hanging processes as needed. To list and terminate
local processes, please use <code><a href="../reference/crew_monitor_local.html">crew_monitor_local()</a></code> as
explained in the introduction vignette. To manage and monitor non-local
high-performance computing workers such as those on SLURM and AWS Batch,
please familiarize yourself with the given computing platform, and
consider using the monitor objects in the relevant third-party plugin
packages such as <a href="https://wlandau.github.io/crew.cluster/"><code>crew.cluster</code></a>
or <a href="https://wlandau.github.io/crew.aws.batch/"><code>crew.aws.batch</code></a>.
Example: <a href="https://wlandau.github.io/crew.aws.batch/index.html#job-management" class="uri">https://wlandau.github.io/crew.aws.batch/index.html#job-management</a>.</p>
</div>
<div class="section level3">
<h3 id="crashes">Crashes<a class="anchor" aria-label="anchor" href="#crashes"></a>
</h3>
<p>The local process or <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>
dispatcher process could crash. A common cause of crashes is running out
of computer memory. The “Resources” section of the <a href="https://wlandau.github.io/crew/articles/introduction.html">introduction</a>
explains how to monitor memory usage. If you are running
<code>crew</code> in a <a href="https://docs.ropensci.org/targets/" class="external-link"><code>targets</code></a>
pipeline (as explained <a href="https://books.ropensci.org/targets/crew.html" class="external-link">here in the
<code>targets</code> user manual</a>), consider setting
<code>storage = "worker"</code> and <code>retrieval = "worker</code> in
<code>tar_option_set()</code> to minimize memory consumption of the
local processes (see also the <a href="https://books.ropensci.org/targets/performance.html" class="external-link">performance
chapter</a>).</p>
<p>In addition, <code>crew</code> worker processes may crash silently at
runtime, or they may fail to launch or connect at all. The reasons may
be platform-specific, but here are some common possibilities:</p>
<ul>
<li>Memory: if a worker exhausts the available memory limits, it will
crash, and there is no way to relay an informative error message. Please
read <a href="https://wlandau.github.io/crew/articles/logging.html" class="uri">https://wlandau.github.io/crew/articles/logging.html</a> to
learn about proactive resource logging, which can generate data to help
troubleshoot in the event of a crash. If you need more memory, <a href="https://wlandau.github.io/crew.aws.batch/"><code>crew.aws.batch</code></a>
and <a href="https://wlandau.github.io/crew.cluster/"><code>crew.cluster</code></a>
expose special platform-specific parameters in the controllers to do
this.</li>
<li>Connections: each worker must run on the same local network as the
controlling R process, and it must be able to dial into that controlling
process over TCP. Firewalls and proxies may interfere, and these
safeguards exist for good reason, so please ensure any custom networking
you do is safe and secure. For example, it is most likely not secure for
these connections to pass through the public internet. For AWS Batch, we
recommend you run the controlling R process and all the workers in an
isolated security group that points to itself (details: <a href="https://wlandau.github.io/crew.aws.batch/#prerequisites" class="uri">https://wlandau.github.io/crew.aws.batch/#prerequisites</a>).
You may have to discuss with your system administrator.</li>
<li>Tasks: R code may crash or segfault the worker and cause it to
abruptly exit. If that happens, see if you can isolate the problem
locally, then debug the code that caused the crash.</li>
</ul>
</div>
<div class="section level3">
<h3 id="ports">Ports<a class="anchor" aria-label="anchor" href="#ports"></a>
</h3>
<p>In addition, <code>crew</code> occupies one TCP port per controller.
TCP ports range from 0 to 65535, and only around 16000 of these ports
are considered ephemeral or dynamic, so please be careful not to run too
many controllers simultaneously on shared machines, especially in <a href="https://wlandau.github.io/crew/articles/groups.html">controller
group</a>. The <code>terminate()</code> frees these ports again for
other processes to use.</p>
</div>
</div>
<div class="section level2">
<h2 id="security">Security<a class="anchor" aria-label="anchor" href="#security"></a>
</h2>
<p>By default, <code>crew</code> uses unencrypted TCP connections for
transactions among workers. In a compromised network, an attacker can
read the data in transit, and even gain direct access to the client or
host.</p>
<div class="section level3">
<h3 id="perimeters">Perimeters<a class="anchor" aria-label="anchor" href="#perimeters"></a>
</h3>
<p>It is best to avoid persistent direct connections between your local
computer and the public internet. The <code>host</code> argument of the
controller should not be a public IP address. Instead, please try to
operate entirely within a perimeter such as a firewall, a virtual
private network (VPN), or an Amazon Web Services (AWS) security group.
In the case of AWS, your security group can open ports to itself. That
way, the <code>crew</code> workers on e.g. AWS Batch jobs can connect to
a <code>crew</code> client running in the same security group on an AWS
Batch job or EC2 instance.</p>
</div>
<div class="section level3">
<h3 id="encryption">Encryption<a class="anchor" aria-label="anchor" href="#encryption"></a>
</h3>
<p>In the age of Zero Trust, perimeters alone are seldom sufficient.
Transport layer security (TLS) encrypts data to protect it from hackers
while it travels over a network. TLS is the state of the art of
encryption for network communications, and it is responsible for
security in popular protocols such as HTTPS and SSH. TLS is based on
public key cryptography, which requires two files:</p>
<ol style="list-style-type: decimal">
<li>A private key file which lives in a protected location on the host
machine.</li>
<li>A public key file which is sent to the remote machine on the other
side of the connection.</li>
</ol>
<p>To use TLS in <code>crew</code> with automatic configuration, simply
set <code>tls = crew_tls(mode = "automatic")</code> in the controller,
e.g. <code><a href="../reference/crew_controller_local.html">crew_controller_local()</a></code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://wlandau.github.io/crew/articles/plugins.html"&gt;Launcher
plugins&lt;/a&gt; should expose the &lt;code&gt;tls&lt;/code&gt; argument of
&lt;code&gt;&lt;a href="../reference/crew_client.html"&gt;crew_client()&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;'><sup>1</sup></a> <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>
generates a one-time key pair and encrypts data for the current
<code>crew</code> client. The key pair expires when the client
terminates, which reduces the risk of a breach. In addition, the public
key is a self-signed certificate, which somewhat protects against
tampering on its way from the client to the server.</p>
</div>
<div class="section level3">
<h3 id="certificate-authorities">Certificate authorities<a class="anchor" aria-label="anchor" href="#certificate-authorities"></a>
</h3>
<p>The signature in a self-signed certificate helps the server verify
that the public key has a valid private key somewhere. However, in a
“man-in-the-middle” (MITM) attack, that private key could belong to a
malicious hacker instead of the true client. A certificate authority
(CA) is a trusted third party that vouches for the authenticity of a
certificate. A CA-backed certificate is more secure than a self-signed
one. To supply a CA-backed certificate to <code>crew</code>:</p>
<ol style="list-style-type: decimal">
<li>Create a PEM-formatted private key file and matching PEM-formatted
certificate file. Details are in <a href="https://www.feistyduck.com/library/openssl-cookbook/online/" class="external-link uri">https://www.feistyduck.com/library/openssl-cookbook/online/</a>
Chapter 1.2: Key and Certificate Management. When you are done with this
step, you should at least have have a private key file, a matching
signed certificate, and the root certificate of the CA. If your private
key is encrypted, you will also have a password.</li>
<li>When you create a <code>crew</code> controller, create a TLS
configuration object with <code><a href="../reference/crew_tls.html">crew_tls()</a></code> using the following
arguments:
<ul>
<li>
<code>mode</code>: <code>"custom"</code>.</li>
<li>
<code>key</code>: file path the private key.</li>
<li>
<code>pass</code>: Your private key password if the private key is
encrypted. Do not hard-code this value into any R code files. Instead,
use a package like <code>keyring</code> to mask your password.</li>
<li>
<code>certificates</code>: Character vector of file paths to
certificates. One option is to supply only your own certificate.
However, for extra security, you may wish to supply the entire
certificate chain. In that case, set <code>certificates</code> to the
character vector of the certificate file paths in the order they appear
in the chain. Begin with your own certificate, then list the certificate
that signed it, then the certificate that signed that one, and so on.
The final certificate should be the root certificate of the CA.</li>
</ul>
</li>
<li>As before, supply this <code><a href="../reference/crew_tls.html">crew_tls()</a></code> object to the
<code>tls</code> argument of functions like
<code><a href="../reference/crew_controller_local.html">crew_controller_local()</a></code> (and for plugin developers,
<code><a href="../reference/crew_client.html">crew_client()</a></code>).</li>
</ol>
<p><a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>, <a href="https://github.com/shikokuchuo/nanonext" class="external-link"><code>nanonext</code></a>,
and <a href="https://nng.nanomsg.org" class="external-link">NNG</a> manage encryption behind
the scenes. For more details about configuring TLS, please read <a href="https://github.com/shikokuchuo/mirai#distributed-computing-tls-secure-connections" class="external-link uri">https://github.com/shikokuchuo/mirai#distributed-computing-tls-secure-connections</a>.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Eli Lilly and Company.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
